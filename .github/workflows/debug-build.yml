name: debug build
on:
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-24.04-arm
    steps:
      - uses: actions/checkout@v4
      - uses: pocketblue/actions/partition-images@main
        with:
          config_file: ./config.toml
          esp_size: 268435456
          rootfs: ext4
          registry: ${{ vars.REGISTRY }}
          image_name: oneplus6-gnome-mobile
          image_tag: 42
      - name: build common
        run: |
          curl -L https://7-zip.org/a/7z2501-linux-arm64.tar.xz | tar -xJf -
          sudo cp 7zzs /bin/7z
          bash common_build.sh
      - name: build oneplus6
        run: |
          env --chdir=oneplus6 bash build.sh
      - name: build oneplus6t
        run: |
          env --chdir=oneplus6t bash build.sh
      - uses: actions/upload-artifact@v4
        with:
          name: dualboot_oneplus6
          path: oneplus6/dualboot_oneplus6.7z
      - uses: actions/upload-artifact@v4
        with:
          name: dualboot_oneplus6t
          path: oneplus6t/dualboot_oneplus6t.7z
